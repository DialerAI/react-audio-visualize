(function(y,j){typeof exports=="object"&&typeof module<"u"?j(exports,require("react/jsx-runtime"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react"],j):(y=typeof globalThis<"u"?globalThis:y||self,j(y.AudioVisualize={},y.ReactJsxRuntime,y.React))})(this,function(y,j,m){"use strict";const M=(n,o,x,d)=>{let c=o/(x+d),f=Math.floor(n.length/c);c>n.length&&(c=n.length,f=1);const p=[];for(let e=0;e<c;e++){let l=0;for(let u=0;u<f&&e*f+u<n.length;u++)l+=n[e*f+u];p.push(l/f)}return p},V=(n,o,x,d,c,f)=>{const p=o.height/2,e=o.getContext("2d");e&&(e.clearRect(0,0,o.width,o.height),c!=="transparent"&&(e.fillStyle=c,e.fillRect(0,0,o.width,o.height)),n.forEach((l,u)=>{e.fillStyle=f;const s=u*(x+d),t=p-l/2,h=x,g=l||1;e.beginPath(),e.roundRect?(e.roundRect(s,t,h,g,50),e.fill()):e.fillRect(s,t,h,g)}))},P=({mediaRecorder:n,width:o="100%",height:x="100%",barWidth:d=2,gap:c=1,backgroundColor:f="transparent",barColor:p="rgb(160, 198, 255)",fftSize:e=1024,maxDecibels:l=-10,minDecibels:u=-90,smoothingTimeConstant:s=.4})=>{const[t,h]=m.useState(),[g,S]=m.useState(),[r,D]=m.useState(),w=m.useRef(null);m.useEffect(()=>{if(!n.stream)return;const i=new AudioContext,R=i.createAnalyser();D(R),R.fftSize=e,R.minDecibels=u,R.maxDecibels=l,R.smoothingTimeConstant=s;const z=i.createMediaStreamSource(n.stream);return z.connect(R),h(i),S(z),()=>{z.disconnect(),R.disconnect(),i.state!=="closed"&&i.close()}},[n.stream]),m.useEffect(()=>{r&&n.state==="recording"&&A()},[r,n.state]);const A=m.useCallback(()=>{if(!r||!t)return;const i=new Uint8Array(r==null?void 0:r.frequencyBinCount);n.state==="recording"?(r==null||r.getByteFrequencyData(i),a(i),requestAnimationFrame(A)):n.state==="paused"?a(i):n.state==="inactive"&&t.state!=="closed"&&t.close()},[r,t==null?void 0:t.state]);m.useEffect(()=>()=>{t&&t.state!=="closed"&&t.close(),g==null||g.disconnect(),r==null||r.disconnect()},[]);const a=i=>{if(!w.current)return;const R=M(i,w.current.width,d,c);V(R,w.current,d,c,f,p)};return j.jsx("canvas",{ref:w,width:o,height:x,style:{aspectRatio:"unset"}})},C=(n,o,x,d,c)=>{const f=n.getChannelData(0),p=x/(d+c),e=Math.floor(f.length/p),l=o/2;let u=[],s=0;for(let t=0;t<p;t++){const h=[];let g=0;const S=[];let r=0;for(let a=0;a<e&&t*e+a<n.length;a++){const i=f[t*e+a];i<=0&&(h.push(i),g++),i>0&&(S.push(i),r++)}const D=h.reduce((a,i)=>a+i,0)/g,A={max:S.reduce((a,i)=>a+i,0)/r,min:D};A.max>s&&(s=A.max),Math.abs(A.min)>s&&(s=Math.abs(A.min)),u.push(A)}if(l*.8>s*l){const t=l*.8/s;u=u.map(h=>({max:h.max*t,min:h.min*t}))}return u},B=(n,o,x,d,c,f,p,e=0,l=1)=>{const u=o.height/2,s=o.getContext("2d");if(!s)return;s.clearRect(0,0,o.width,o.height),c!=="transparent"&&(s.fillStyle=c,s.fillRect(0,0,o.width,o.height));const t=(e||0)/l;n.forEach((h,g)=>{const S=g/n.length,r=t>S;s.fillStyle=r&&p?p:f;const D=g*(x+d),w=u+h.min,A=x,a=u+h.max-w;s.beginPath(),s.roundRect?(s.roundRect(D,w,A,a,50),s.fill()):s.fillRect(D,w,A,a)})},E=m.forwardRef(({blob:n,width:o,height:x,barWidth:d=2,gap:c=1,currentTime:f,style:p,backgroundColor:e="transparent",barColor:l="rgb(184, 184, 184)",barPlayedColor:u="rgb(160, 198, 255)"},s)=>{const t=m.useRef(null),[h,g]=m.useState([]),[S,r]=m.useState(0);return m.useImperativeHandle(s,()=>t.current,[]),m.useEffect(()=>{(async()=>{if(!t.current)return;if(!n){const a=Array.from({length:100},()=>({max:0,min:0}));B(a,t.current,d,c,e,l,u);return}const w=await n.arrayBuffer();await new AudioContext().decodeAudioData(w,a=>{if(!t.current)return;r(a.duration);const i=C(a,x,o,d,c);g(i),B(i,t.current,d,c,e,l,u)})})()},[n,t.current]),m.useEffect(()=>{t.current&&B(h,t.current,d,c,e,l,u,f,S)},[f,S]),j.jsx("canvas",{ref:t,width:o,height:x,style:{...p}})});E.displayName="AudioVisualizer",y.AudioVisualizer=E,y.LiveAudioVisualizer=P,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
